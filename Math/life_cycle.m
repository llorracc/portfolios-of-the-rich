(* This file sets up the variables to allow different circumstances during different parts of the life cycle *)ProbOfDeath = Table[{},{YearsOfLife+1}];DiscountFactor = .94;  (* Period 1 is age 21 *)ProbOfDeath[[1]]=	0.00000	;ProbOfDeath[[2]]=	0.00058	;ProbOfDeath[[3]]=	0.00061	;ProbOfDeath[[4]]=	0.00062	;ProbOfDeath[[5]]=	0.00064	;ProbOfDeath[[6]]=	0.00065	;ProbOfDeath[[7]]=	0.00067	;ProbOfDeath[[8]]=	0.00069	;ProbOfDeath[[9]]=	0.00070	;ProbOfDeath[[10]]=	0.00072	;ProbOfDeath[[11]]=	0.00075	;ProbOfDeath[[12]]=	0.00078	;ProbOfDeath[[13]]=	0.00082	;ProbOfDeath[[14]]=	0.00086	;ProbOfDeath[[15]]=	0.00091	;ProbOfDeath[[16]]=	0.00098	;ProbOfDeath[[17]]=	0.00105	;ProbOfDeath[[18]]=	0.00115	;ProbOfDeath[[19]]=	0.00128	;ProbOfDeath[[20]]=	0.00144	;ProbOfDeath[[21]]=	0.00161	;ProbOfDeath[[22]]=	0.00180	;ProbOfDeath[[23]]=	0.00200	;ProbOfDeath[[24]]=	0.00221	;ProbOfDeath[[25]]=	0.00242	;ProbOfDeath[[26]]=	0.00266	;ProbOfDeath[[27]]=	0.00292	;ProbOfDeath[[28]]=	0.00320	;ProbOfDeath[[29]]=	0.00349	;ProbOfDeath[[30]]=	0.00380	;ProbOfDeath[[31]]=	0.00413	;ProbOfDeath[[32]]=	0.00450	;ProbOfDeath[[33]]=	0.00490	;ProbOfDeath[[34]]=	0.00533	;ProbOfDeath[[35]]=	0.00581	;ProbOfDeath[[36]]=	0.00632	;ProbOfDeath[[37]]=	0.00689	;ProbOfDeath[[38]]=	0.00749	;ProbOfDeath[[39]]=	0.00811	;ProbOfDeath[[40]]=	0.00878	;ProbOfDeath[[41]]=	0.00952	;ProbOfDeath[[42]]=	0.01033	;ProbOfDeath[[43]]=	0.01124	;ProbOfDeath[[44]]=	0.01223	;ProbOfDeath[[45]]=	0.01332	;ProbOfDeath[[46]]=	0.01455	;ProbOfDeath[[47]]=	0.01590	;ProbOfDeath[[48]]=	0.01730	;ProbOfDeath[[49]]=	0.01874	;ProbOfDeath[[50]]=	0.02028	;ProbOfDeath[[51]]=	0.02203	;ProbOfDeath[[52]]=	0.02404	;ProbOfDeath[[53]]=	0.02623	;ProbOfDeath[[54]]=	0.02863	;ProbOfDeath[[55]]=	0.03128	;ProbOfDeath[[56]]=	0.03432	;ProbOfDeath[[57]]=	0.03778	;ProbOfDeath[[58]]=	0.04166	;ProbOfDeath[[59]]=	0.04597	;ProbOfDeath[[60]]=	0.05078	;ProbOfDeath[[61]]=	0.05615	;ProbOfDeath[[62]]=	0.06214	;ProbOfDeath[[63]]=	0.06885	;ProbOfDeath[[64]]=	0.07631	;ProbOfDeath[[65]]=	0.08455	;ProbOfDeath[[66]]=	0.09352	;ProbOfDeath[[67]]=	0.10323	;ProbOfDeath[[68]]=	0.11367	;ProbOfDeath[[69]]=	0.12484	;ProbOfDeath[[70]]=	0.13677	;ProbOfDeath[[71]]=	0.14938	;ProbOfDeath[[72]]=	0.16289	;ProbOfDeath[[73]]=	0.17721	;ProbOfDeath[[74]]=	0.19234	;ProbOfDeath[[75]]=	0.20828	;ProbOfDeath[[76]]=	0.22418	;ProbOfDeath[[77]]=	0.23980	;ProbOfDeath[[78]]=	0.25495	;ProbOfDeath[[79]]=	0.26937	;ProbOfDeath[[80]]=	0.28284	;ProbOfDeath[[81]]=	1;(*# For simplicity, set up the model with constant probability of death = 0 *)(*ProbOfDeath = Table[0,{80}];*)betaannual = Table[{},{LifeLength+1}];Do[betaannual[[(LoopOverYear-1)*PeriodsPerYear+LoopOverPeriodsOfYear]] = DiscountFactor,   {LoopOverPeriodsOfYear,PeriodsPerYear},{LoopOverYear,YearsOfLife}];(* In the last period of life, EtVtp1 is zero, so this value of beta doesn't matter, but can't be zero times zero *)betaannual[[LifeLength+1]] = betaannual[[LifeLength]];(* Note: age = year + 20 *)NumOfLifeStages = 3;StartOfLifeStage1 = 1;   (* age 21 *)StartOfLifeStage2 = 1+PeriodsPerYear*30;  (* age 51/year 31 which is period 81 in quarterly data *)StartOfLifeStage3 = 1+PeriodsPerYear*45;  (* age 66/year 46 which is period 181 in quarterly data *)(* Note: in part 3 you are retired until you die 35 years later at age 100 *)StartOfLifeStage={StartOfLifeStage1,StartOfLifeStage2,StartOfLifeStage3};GrowthPart1    =1.04;GrowthPart2    =1.02;GrowthPart3    =1.00;Part1Growth={GrowthPart1,GrowthPart1,GrowthPart1};Part2Growth={GrowthPart2,GrowthPart2,GrowthPart2};Part3Growth={GrowthPart3,GrowthPart3,GrowthPart3};(*Part1Growth=Table[GrowthPart1,{NumOfQStates}];Part2Growth=Table[GrowthPart2,{NumOfQStates}];Part3Growth=Table[GrowthPart3,{NumOfQStates}];*)RetirementReplacementRatio = .7;Gannual=Table[{},{LifeLength}];Gannual[[1]] = 1;Do[Gannual[[LoopOverLifePosn]]=Gannual[[LoopOverLifePosn-1]]*GrowthPart1,{LoopOverLifePosn,2,StartOfLifeStage2-1}];Do[Gannual[[LoopOverLifePosn]]=Gannual[[LoopOverLifePosn-1]]*GrowthPart2,{LoopOverLifePosn,StartOfLifeStage2,StartOfLifeStage3-1}];Gannual[[StartOfLifeStage3]]=Gannual[[StartOfLifeStage3-1]] *GrowthPart3*RetirementReplacementRatio;Do[Gannual[[LoopOverLifePosn]]=Gannual[[LoopOverLifePosn-1]]*GrowthPart3,{LoopOverLifePosn,StartOfLifeStage3+1,LifeLength}];(* Note that the growth rate between period t and period t+1 is defined as G[[LifePosn+1]] *)etValsPart3 = epValsPart3 = {1.};epProbPart3 = etProbPart3 = {1.};{etValsTemp,etProbTemp} = DiscreteApproxToMeanOneLogNormalWithCutoff[Cutoff,etSig,NumOfetVals];If[etZeroProb>0,  (* then *)      etValsTemp = Prepend[etValsTemp,0];     etProbTemp = (1-etZeroProb)etProbTemp;     etProbTemp = Prepend[etProbTemp,etZeroProb]  ]; (* End If etZeroProb>0 *){etValsPart3,etProbPart3} = {etValsTemp,etProbTemp};{epValsPart2,epProbPart2} = {{1.},{1.}};{etValsPart2,etProbPart2} = {etValsTemp,etProbTemp};{epValsPart1,epProbPart1} = {{1.},{1.}};{etValsPart1,etProbPart1} = {etValsTemp,etProbTemp};etValsByStageOfLife = {{{etValsPart1}},{{etValsPart2}},{{etValsPart3}}};epValsByStageOfLife = {{{epValsPart1}},{{epValsPart2}},{{epValsPart3}}};etProbByStageOfLife = {{{etProbPart1}},{{etProbPart2}},{{etProbPart3}}};epProbByStageOfLife = {{{epProbPart1}},{{epProbPart2}},{{epProbPart3}}};etVals=epVals=etProb=epProb=Table[{},{LifeLength}];Do[etVals[[LoopOverLifePosn]]=Table[etValsPart1,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,1,StartOfLifeStage2-1}];Do[etVals[[LoopOverLifePosn]]=Table[etValsPart2,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,StartOfLifeStage2,StartOfLifeStage3-1}];Do[etVals[[LoopOverLifePosn]]=Table[etValsPart3,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,StartOfLifeStage3,LifeLength}];Do[epVals[[LoopOverLifePosn]]=Table[epValsPart1,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,1,StartOfLifeStage2-1}];Do[epVals[[LoopOverLifePosn]]=Table[epValsPart2,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,StartOfLifeStage2,StartOfLifeStage3-1}];Do[epVals[[LoopOverLifePosn]]=Table[epValsPart3,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,StartOfLifeStage3,LifeLength}];Do[etProb[[LoopOverLifePosn]]=Table[etProbPart1,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,1,StartOfLifeStage2-1}];Do[etProb[[LoopOverLifePosn]]=Table[etProbPart2,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,StartOfLifeStage2,StartOfLifeStage3-1}];Do[etProb[[LoopOverLifePosn]]=Table[etProbPart3,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,StartOfLifeStage3,LifeLength}];Do[epProb[[LoopOverLifePosn]]=Table[epProbPart1,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,1,StartOfLifeStage2-1}];Do[epProb[[LoopOverLifePosn]]=Table[epProbPart2,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,StartOfLifeStage2,StartOfLifeStage3-1}];Do[epProb[[LoopOverLifePosn]]=Table[epProbPart3,{NumOfQStates},{NumOfEmpStates}],{LoopOverLifePosn,StartOfLifeStage3,LifeLength}];etProbCum =  Table[    CumulativeSums[etProb[[LoopOverLife,LoopOverAggStates,LoopOverEmpStates]]]    ,{LoopOverLife,LifeLength}    ,{LoopOverEmpStates,NumOfEmpStates}    ,{LoopOverAggStates,NumOfQStates}  ];epProbCum =  Table[    CumulativeSums[epProb[[LoopOverLife,LoopOverAggStates,LoopOverEmpStates]]]    ,{LoopOverLife     ,LifeLength}    ,{LoopOverEmpStates,NumOfEmpStates}    ,{LoopOverAggStates,NumOfQStates}  ];